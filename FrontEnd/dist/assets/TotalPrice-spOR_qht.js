import{r as n,g as T,u as I,a as l,j as t,d as C,S as x}from"./vendor-D_SluWwt.js";import{Q as k,B as O,P as D,a as Q,C as z}from"./index-BosGv7D6.js";const F=()=>{n.useState({});const{quantityState:p}=n.useContext(k);return{totalDiscount:s=>{const o=s;return o==null?void 0:o.reduce((c,a)=>{const u=p[a._id]||1;return c+parseInt(Math.ceil(a.price-a.price*a.original_price/100))*u},0)},totalPrice:s=>{const o=s;return o==null?void 0:o.reduce((c,a)=>{const u=p[a._id]||1;return c+parseInt(a.price)*u},0)}}};function M(){const i=T().id,d=I(),{totalDiscount:s,totalPrice:o}=F(),[y,c]=n.useState(!0),[a,u]=n.useState(null),{btnState:P,btnDispatch:B}=n.useContext(O),{paymentState:N}=n.useContext(D),{quantityState:f}=n.useContext(k),{paymentMethodState:m}=n.useContext(Q),{cartDispatch:g}=n.useContext(z);n.useEffect(()=>{l.get("https://mern-fullstack-1-j3k1.onrender.com/addTocard",{withCredentials:!0}).then(e=>{v(e.data),c(!1)}).catch(e=>{c(!1),u(e.message),console.log(e),d("/login")})},[i,d]);function S(){Object.keys(f).length>0&&l.post("https://mern-fullstack-1-j3k1.onrender.com/updateQuantity",f,{withCredentials:!0}).then(e=>{}).catch(e=>console.log(e))}const b=()=>{if(m!=null)if(m==="Online Payment"){const e={key:"rzp_test_zFG2soycp0tt1P",amount:s(r.data)*100,currency:"INR",handler:function(w){x.fire({title:"Order place and Payment Done ,successfully",icon:"success",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ok!"}),d("/"),l.post(`https://mern-fullstack-1-j3k1.onrender.com/placeOrder/${i}`,m,{withCredentials:!0}).then(j=>{g({type:"cart",payload:!0}),j&&(l.get("https://mern-fullstack-1-j3k1.onrender.com/deleteProductFormAddToCard",{withCredentials:!0}),localStorage.removeItem("page"))}).catch(j=>console.log(j))}},h=window.Razorpay(e);h.open(),h.on("payment fail",function(w){x.fire({title:"Payment Failed",icon:"success",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ok!"})})}else l.post(`https://mern-fullstack-1-j3k1.onrender.com/placeOrder/${i}`,m,{withCredentials:!0}).then(e=>{d("/"),localStorage.setItem("order","Order Place Successfully");const h=localStorage.getItem("order");x.fire({title:h,icon:"success",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ok!"}),localStorage.removeItem("order"),e&&l.get("https://mern-fullstack-1-j3k1.onrender.com/deleteProductFormAddToCard",{withCredentials:!0}),g({type:"cart",payload:!0})}).catch(e=>console.log(e));else x.fire({title:"Plz Select Payment Method",icon:"warning",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"ok!"})},[r,v]=n.useState([]);return t.jsx(t.Fragment,{children:r.data?t.jsx("div",{children:t.jsx("div",{className:"total",children:t.jsxs("div",{className:"totalContainer",children:[t.jsx("h4",{children:"Product Detail"}),t.jsxs("div",{className:"totalPrice",children:[t.jsx("h5",{style:{borderBottom:"2px dotted grey"},children:"Total Product Price:"}),t.jsxs("span",{children:["+ ₹",o(r.data)]})]}),t.jsxs("div",{className:"totalPrice mb-0",style:{color:"green"},children:[t.jsx("h5",{style:{color:"green",borderBottom:"2px dotted green"},children:"Total Discount"}),t.jsxs("span",{children:["-₹",o(r.data)-s(r.data)]})]}),t.jsx("hr",{}),t.jsxs("div",{className:"order",children:[t.jsx("h5",{children:"Order Total:"}),t.jsxs("span",{children:["₹",s(r.data)]})]}),t.jsxs("div",{children:[t.jsxs("h6",{className:"text-center text-success",children:["You Save : ",s(r.data)-o(r.data)]}),t.jsx("span",{className:"btnHeading",children:"Clicking on Continue will not deduct any money"}),t.jsxs(C,{to:`/addAddress/${i}`,children:[" ",P&&t.jsx("button",{className:"form-button d-block my-2 conBtn",onClick:()=>{B({type:"btn",payload:!1}),S()},children:"Continue"})]}),t.jsx("form",{action:b,method:"post",children:N===!1&&t.jsx("button",{className:"form-button d-block my-2 conBtn",onClick:()=>localStorage.getItem("BuyNow"),children:"Continue1"})})]})]})})}):t.jsx("div",{className:"total h-25",children:t.jsxs("div",{className:"totalContainer",children:[t.jsx("h4",{}),t.jsxs("div",{className:"totalPrice",children:[t.jsx("h5",{style:{borderBottom:"2px dotted grey"}}),t.jsx("span",{})]}),t.jsxs("div",{className:"totalPrice mb-0",style:{color:"green"},children:[t.jsx("h5",{style:{color:"green",borderBottom:"2px dotted green"}}),t.jsx("span",{})]}),t.jsx("hr",{}),t.jsxs("div",{className:"order",children:[t.jsx("h5",{}),t.jsx("span",{})]}),t.jsxs("div",{children:[t.jsx("h6",{className:"text-center text-success"}),t.jsx("span",{className:"btnHeading",children:"Clicking on Continue will not deduct any money"}),t.jsx(C,{children:" "})]})]})})})}export{M as T,F as u};
